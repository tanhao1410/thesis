<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>服务器设备监控管理系统</title>
    <link rel="stylesheet" href="./plugins/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="./css/header.css">
    <link rel="stylesheet" href="./plugins/font-awesome/css/all.css">
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/public.css">
    <script src="./plugins/vue.js"></script>
    <script src="./plugins/element-ui/lib/index.js"></script>
    <script src="./plugins/axios.js"></script>
    <script src="./plugins/http.js"></script>
    <script src="./plugins/component/header.js"></script>
    <script src="./plugins/jquery.js"></script>
    <script src="./plugins/jtopo-0.4.8-min.js"></script>

    <script src="./js/index.js"></script>
    <script src="./js/websocket.js"></script>
</head>

<body>
<div id="app">
    <main-header>
    </main-header>
    <div class="financial-tool-download">

        <div class="title-word">

        </div>

        <div class="button-wrapper">

            <div class="button-wrapper-right">
                <div class="download-wrapper">
                    <el-button
                            plain
                            @click="bulkDownload()"
                            :disabled="downDisable"
                    >
                        <i class="fa fa-cloud-download-alt"></i>
                        所有设备组
                    </el-button>
                </div>
                <div class="summary-wrapper">
                    <el-button
                            type="primary"
                            @click="summary()"
                    >
                        增加设备组
                    </el-button>
                </div>
                <div class="summary-wrapper">
                    <el-button
                            type="primary"
                            @click="summary()"
                    >
                        增加设备
                    </el-button>
                </div>
                <div class="summary-wrapper">
                    <el-button
                            type="primary"
                            @click="summary()"
                    >
                        保存位置
                    </el-button>
                </div>
            </div>
        </div>

    </div>


    <div id="content" style="margin-left: 40px;">
        <canvas width="1200" height="550" id="canvas"></canvas>
    </div>

</div>
</body>
<script>
    var _this = this;
    var app = new Vue({
        el: "#app",
        data: {
            month: "",
            downDisable: true,
            tableData: [],
            loading: false,
            multipleSelection: [],
            // 类型筛选
            fildType: '',
            fildTypeList: []
        },
        mounted() {
            //this.getFildType()
        },
        methods: {
            selectMonth(currentDate) {
                if (currentDate) {
                    this.getTableData()
                }

            },
            getTableData() {
                this.loading = true;
                let params = {
                    month: this.month,
                    type: this.fildType
                };
                httpGet("/finaTool/uploadServer/downloadFileList", params, this, (err, res) => {
                    this.loading = false;
                    if (!err) {
                        if (0 === res.code) {
                            this.tableData = res.result.list;
                            if (res.result.month) {
                                this.month = res.result.month
                            }

                        } else {
                            this.$message.error(res.resultMessage);
                        }
                    } else {
                        this.$message.error("获取下载列表数据失败");
                    }
                });
            },
            // 获取类型字典表数据

            // 批量下载
            bulkDownload() {
                var fileId = '';
                if (0 < this.multipleSelection.length) {
                    this.multipleSelection.forEach((item, index) => {
                        if (this.multipleSelection.length - 1 !== index) {
                            fileId += item.fileId + ','
                        } else {
                            fileId += item.fileId;
                        }
                    })
                    window.open(`/finaTool/uploadServer/downloads?fileIds=${fileId}`, "_blank");
                }

            },
            // 列表中的下载
            download(row) {
                window.open(`/finaTool/uploadServer/downloads?fileIds=${row.fileId}`, "_blank");
            },
            // table中的checkbox框
            selectRow(selection) {
                this.multipleSelection = selection;
                if (this.multipleSelection.length > 0) {
                    this.downDisable = false;
                } else {
                    this.downDisable = true;
                }
            },
            // 汇总
            summary() {
                window.location.href = `/summary.html?month=${this.month}`
            },
            fildTypeChange(val) {
                this.fildType = val;
                console.log('val', val)
                this.getTableData()
            }
        }
    })
</script>
<style>
    .financial-tool-download {
        padding: 0 32px 20px 40px;
    }

    .financial-tool-download .title-word {
        font-size: 18px;
        font-family: Source Han Sans CN;
        font-weight: 400;
        color: #384253;
        line-height: 18px;
        padding: 14px 0 11px;
    }

    .financial-tool-download .button-wrapper {
        display: flex;
        justify-content: space-between;
    }

    .financial-tool-download .button-wrapper .btn-label {
        color: #8C98AD;
        font-size: 14px;
    }

    .financial-tool-download .button-wrapper-right {
        display: flex;
    }

    .download-wrapper button.el-button {
        color: #3A8DE3;
        border: 1px solid #3A8DE3;
    }

    .download-wrapper .el-button:hover {
        background: #3A8DE3;
        color: #fff;
    }

    .summary-wrapper {
        margin-left: 9px;
    }

</style>

</html>